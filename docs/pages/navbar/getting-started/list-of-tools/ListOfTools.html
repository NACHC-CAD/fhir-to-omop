<html>
	
	<head>
		<!-- favicon link -->
		<link rel="shortcut icon" type="image/x-icon" href="../../../../favicon.ico">
		<!-- include lib code -->
		<script src="../../../../site_libs/jquery-1.11.3/jquery.min.js"></script>
		<div id="headerInclude"></div>
		<script>$("#headerInclude").load("/fhir-to-omop/header.html");</script>
	</head>

	<body>
		<div class="container-fluid main-container">

			<!-- navbar -->
			<div id="navbarInclude"></div>
			<script>$("#navbarInclude").load("/fhir-to-omop/navbar.html");</script>

			<h1>List of fhir-to-omop Tools and Utilities: Create and Populate an OMOP CDM Database with FHIR Patients From Scratch</h1>
			<h3>
				Everything you need to:<br/>
				- <a href="#build">Build Your OMOP CDM Database</a><br/>
				- <a href="#get-ids">Get the IDs of the Patients on Your FHIR Server</a><br/>
				- Download Patients from your FHIR Server<br/>
				- Upload your FHIR Patients into Your OMOP CDM Database<br/>
			</h3>
			This page summarizes the tools that are available in the fhir-to-omop project to build and populate and OMOP CDM database from scratch using data from a FHIR Server.  
			All of the components used to do this are also available and can be used independently.  
			These components are listed below as Utilities.  
			These utilities include functionality such as authenticating to a FHIR server using OAUTH2 (or any other method),
			getting a list of patient ids from a FHIR server that can then be used to get patients from a FHIR server, 
			retrieving patients from a FHIR server, converting FHIR patients into OMOP CDM resources, etc.  
			The tools and Utilities listed below are currently provided publicly under the Apache 2 license by the fhir-to-omop project.  
			All of the tools listed here have a simplest complete example listed.  
			These examples are all JUnit integration tests.  
			These examples can be run individually to observe the intended behavior.  
			These tests are also run routinely as part of our build process.  
			To run these tests, follow the instructions for how to 
			<a target="developer" href="/fhir-to-omop/pages/navbar/getting-started/start-here/use-fhir-to-omop/UseFhirToOmopAsADeveloper.html">
				use fhir-to-omop as a developer
			</a>.
			
			<!-- configuration -->
			<h2>Notes on Configuration and Testing</h2>
			All of the fhir-to-omop tools are configured using a single properties file.  
			Most of the parameters in this file are for the instance of OMOP that can be created locally by these tools.  
			Therefore, most of the parameters are all ready populated with default values.  
			A copy of this file is provided in the root directory of the fhir-to-omop.zip file created for each distribution
			(e.g. fhir-to-omop-0.0.14.zip).  
			The fhir-to-omop project maintains a robust set of JUnit integration tests that can be run individually.
			The entire JUnit test suite can be run using the 
			<a target="_blank" href="https://github.com/NACHC-CAD/fhir-to-omop/blob/main/src/test/java/org/nachc/tools/fhirtoomop/RunAllIntegrationTests.java">RunAllIntegrationTests</a> class.  
			
			<!-- notes on design patterns and system architecture -->
			<h2>Notes on Design Patterns and System Architecture</h2>
			Architecture and design of the fhir-to-omop project is discussed in detail 
			<a target="arch" href="/fhir-to-omop/pages/navbar/architecture-and-design/ArchitectureOverview.html">
				here
			</a>, however there are a few key features that should be noted here.  
			<table class="table">
				
				<!-- header -->
				<tr>
					<th>Element</th>
					<th>Description</th>
				</tr>

				<!-- authentication -->
				<tr>
					<td>
						Authentication and Application Parameters
					</td>
					<td>
						All authentication tokens and other configurable parameters are storred in the app.properties file.  
						A (mostly) working example of this file is included in the root of the folder of the zip file that is used by application users.  
						For full functionality you will need to provide your UMLS and Synthea keys.  
						Developers can add an app.properties file to the fhir-to-omop/src/main/resources/auth folder.
						This file is excluded from our repository explicitly in .gitignore and is explicitly removed as part of the deploy build.  
					</td>
				</tr>

				<!-- data value objects -->
				<tr>
					<td>
						Data&nbsp;Value&nbsp;Objects (DVOs)
					</td>
					<td>
						<p>
							The OMOP Common Data Model (CDM) tables are represented in the Java code base of fhir-to-omop as Data Value Objects (DVOs).  
							These data value objects are auto generated by querying the databases meta data and then constructing Java classes that exactly represent these tables.  
						</p>
						<p>
							The intersection between FHIR and OMOP is completely encapsulated in the OmopPersonEverything class.
							The OmopPersonEverything is constructed using and FHIR /Person/[ID]/$everything resource.
							The OmopPersonEverything then provides this resources as collections of DVOs that exactly map to OMOP tables.  
							These DVO objects can then be used to directly write data to the data base using the Dao class.
							These DVO objects can also be used to otherwise represent the data as CDM structures 
							(e.g. by writing the data to CSV files that represent the CDM tables).  
							In some cases additional information is derived from the data.  This additional data is managed using the DvoProxy class
							(which create DVO classes under the hood).  
							Details for the OmopPersonEverything and OmopPersonEverythingFactory are listed in the Utilities section below.  
						</p>
					</td>
				</tr>
				
				<!-- blank row deliberately included to give bottom line -->
				<tr>
					<td>
					</td>
					<td>
					</td>
				</tr>
				
			</table>
			
			<!-- 
			* 
			* tools 
			*
			-->
			
			<a id="build"></a>
			<h2>Tools</h2>
			The fhir-to-omop tools are the more complete solutions that perform complex tasks.
			Things like creating an entire OMOP instance including populated vocabulary tables from scratch.  
			Things like populating an OMOP instance with the entire contents of a FHIR Patient server. 
			All of the Tools listed in this section can be launched from the 
			<a href="">Standalone Application</a>.  
			
			<table class="table">

				<!-- header -->
				<tr>
					<th>Tool</th>
					<th>Description</th>
				</tr>
	
				<!-- build -->
				<tr>
					<td>
						Build Your OMOP CDM Database
					</td>
					<td>
						<p>
							Build a complete OMOP CDM Database
						</p>
						<p>
							The 
							<a target="_blank" href="https://github.com/NACHC-CAD/fhir-to-omop/blob/main/src/main/java/org/nachc/tools/fhirtoomop/tools/build/CreateOmopInstanceTool.java">CreateOmopInstanceTool</a> class 
							will build a complete OMOP CDM database that is ready to receive data and get plugged into OHDSI tools. 
							This tool will 
							<ul>
								<li>Drop the OMOP Database to be created if it exists</li>
								<li>Create the OMOP Database instance using the CDM 5.4 scripts</li>
								<li>Create an OMOP Database user</li>
								<li>Create tables used for mappings</li>
								<li>Create a cdm_source record (this is used by the Data Quality Dashboard)</li>
								<li>Create the sequences used to generate the primary keys when FHIR resources are imported</li>
								<li>Load all of the terminology tables (e.g. concept)</li>
								<li>Create indexes used during the data loading process</li>
							</ul> 
							The following prerequisites must be met before this tool can be run.  
							<ul>
								<li>A running instance of Microsoft Sql Server</li>
								<li>
									A folder containing the files that define the vocabularies to be used for the instance downloaded from 
									<a href="https://athena.ohdsi.org">Athena</a>
								</li>
								<li>
									Correct settings in the app.properties file. 
									The <a href="">app.properties</a>  
									file provided with the distribution has everything required for a default build 
									except for the location of your Athena vocabularies files 
									and the settings for your MS Sql Server database.  
								</li>
							</ul>
							
							This tool can be run using the 
							<a target="_blank" href="https://github.com/NACHC-CAD/fhir-to-omop/blob/main/src/main/java/org/nachc/tools/fhirtoomop/tools/build/CreateOmopInstanceTool.java">CreateOmopInstanceTool</a> class 
							directly.  This class has a main method that will create the database, user, etc. based on the parameters in the app.properties file.  
						</p>							
						<p>
							<a id="get-ids"></a>
							This tool can be run from the <a href="">Standalone Application</a> using the "instant-omop" or "i" option:
							<br/>
							fhir-to-omop instant-omop
							<br/>
							fhir-to-omop i
						</p>
					</td>
				</tr>

				<!-- get-ids -->
				<tr>
					<td>
						Get the IDs of the Patients on Your FHIR Server
					</td>
					<td>
						<p>
							Get a list of all of the IDs for all of the patients on a FHIR server.
						</p>
						<p>
							Before you can ask for a patient, you'll need to know what patients exist on a server.  
							This tool can be used to fetch the entire list of patients that exist on a server.
							The ids will be written to a list of files with 1000 patient ids each.
							The files are written to the dir specified in the app.properties file as fhirPatientIdDir.
							This utility gets all of its parameters from the app.properties file.  
							The test example below uses Synthea as a test patient server.  
							To run the test you will need to get Synthea credentials as describe in the 
							<a target="getting-started2" href="/fhir-to-omop/pages/navbar/getting-started/start-here/StartHere.html">
								Getting Started
							</a> document.  
						</p>
						<p>
							This tool can be run using the 
							<a href="https://github.com/NACHC-CAD/fhir-to-omop/blob/main/src/test/java/org/nachc/tools/fhirtoomop/tools/download/DownloadPatientIdsIntegrationTest.java">DownloadPatientIdsIntegrationTest</a>
						</p>
						<p>
							<a id="get-ids"></a>
							This tool can be run from the <a href="">Standalone Application</a> using the "download-patient-ids" or "ids" option:
							<br/>
							fhir-to-omop download-patient-ids
							<br/>
							fhir-to-omop ids
						<p>
					</td>
				</tr>

				<!-- blank row deliberately included to give bottom line -->
				<tr>
					<td>
					</td>
					<td>
					</td>
				</tr>

				
			</table>
			
			<h1>Utilities</h1>
			The fhir-to-omop utilities are the building blocks of the fhir-to-omop environment.  
			These tools can be used individually.
			Each tool has a simplest complete example that exists as a JUnit integration test in the fhir-to-omop project.  
			This integration test is listed at the bottom of the description for each entry in the list below.  
			
			<table class="table">
				
				<!-- header -->
				<tr>
					<th>Resource</th>
					<th>Description</th>
				</tr>
	
				<!-- SyntheaOauth -->
				<tr>
					<td>
						FHIR:&nbsp;SyntheaOauth
					</td>
					<td>
						<p>
							Get an OAUTH2 token from the Synthea patient server.  
						</p>
						<p>
							The SyntheaOauth tool gets an OAUTH token from the Synthea Patient server used as a reference implementation for the fhir-to-omop tool suite.  
							There seems to be some variation in how OAUTH authentication is done from server to server.  
							This class works for the Synthea Patient server we use here and may or may not work with other servers.  
						</p>					
						<p>
							Example: The 
							<a target="_blank" href="https://github.com/NACHC-CAD/fhir-to-omop/blob/main/src/test/java/org/nachc/tools/fhirtoomopexamples/fhir/oauth/SyntheaOauthIntegrationTest.java">
								SyntheaOauthIntegrationTest
							</a> class gives a simplest complete example of the use of this tool.  
						</p>
					</td>
				</tr>

				<!-- get list of patients -->				
				<tr>
					<td>
						FHIR:&nbsp;GetAllPatientIdsTool
					</td>
				</tr>
				
				<!-- FHIR: FhirPatientEverythingFetcher  -->
				<tr>
					<td>
						FHIR:&nbsp;FhirPatientEverythingFetcher
					</td>
					<td>
						Get a Patient/[ID]/$everything resource from any FHIR Patient server.  
						<br/><br/>
						<p>
							The FhirPatientEverythingFetcher is used to get the JSON string representing all of the information the server has for a given patient.  
							Although it is intended to be used for any FHIR server, there does seem to be differences in the way FHIR Patient servers implement authentication.  
							In our simplest complete example, we are using a Synthea Patient server and the SyntheaOauth tool to generate the token needed for the request.  
							Getting an account and credentials required to get this token are described in our list of 
							<a target="start-here" href="/fhir-to-omop/pages/navbar/getting-started/start-here/StartHere.html">prerequisites</a>.
						</p>
						<p>
							The tool requires these parameters
							<ul>
								<li>The URL of the FHIR Patient Server</li>
								<li>The ID of the Patient</li>
								<li>An OAUTH2 token (this can be generated for the Synthea server using the SyntheaOauth tool)</li>
							</ul>
						</p>
						<p>
							Example: 
							The 
							<a target="_blank" href="https://github.com/NACHC-CAD/fhir-to-omop/blob/main/src/test/java/org/nachc/tools/fhirtoomopexamples/fhir/everything/FhirPatientEverythingIntegrationTest.java">
								FhirPatientEverythingIntegrationTest
							</a> 
							class gives a simplest complete example of the use of this tool.  
						</p>
					</td>
				</tr>
				
				<tr>
					<td>
						FHIR:&nbsp;GetASingleSyntheaPatient
					</td>
					<td>
						<p>
							Get a single patient from Synthea.  
						</p>
						<p>
							The GetASingleSyntheaPatient tool gets a single patient as a FHIR json string.  
							This patient is loaded from a file that was created by fetching the /Patient/[ID\/$everything resource from Synthea.  
							This tools is used throughout the JUnit testing code for this project.  
						</p>
						<p>
							Example: The  
							<a target="_blank" href="https://github.com/NACHC-CAD/fhir-to-omop/blob/main/src/test/java/org/nachc/tools/fhirtoomopexamples/synthea/GatASingleSyntheaPatientExampleIntegrationTest.java">
								GatASingleSyntheaPatientExampleIntegrationTest
							</a> represents the simplest complete example of this tool.  
						</p>
					</td>
				</tr>
				
				<!-- fhir-to-omop -->
				<tr>
					<td>
						FHIR-TO-OMOP:<br/>
						OmopPersonEverything
					</td>
					<td>
						<p>
							Convert a single FHIR Patient into a series of OMOP Common Data Model entities.  
						</p>
						<p>
							The intersection between FHIR and OMOP is completely encapsulated in the OmopPersonEverything class.
							The OmopPersonEverything is constructed using and FHIR /Person/[ID]/$everything resource.
							The OmopPersonEverything then provides this resources as collections of DVOs that exactly map to OMOP tables.  
							These DVO objects can then be used to directly write data to the data base using the Dao class.
							These DVO objects can also be used to otherwise represent the data as CDM structures 
							(e.g. by writing the data to CSV files that represent the CDM tables).  
							In some cases additional information is derived from the data.  This additional data is managed using the DvoProxy class
							(which create DVO classes under the hood).  
						</p>
						<p>
							Note that this mapping requires a connection to your OMOP instance.
							All of the concept mapping for FHIR to OMOP is done through the OmopPersonEverything class.  
							This database connection is used to get the OHDSI concept ids from the concept table.  
							The database connection is also used to ensure that OMOP database records get unique ids.  
						</p>
						<p>
							Example: 
							The 
							<a target="_blank" href="https://github.com/NACHC-CAD/fhir-to-omop/blob/main/src/test/java/org/nachc/tools/fhirtoomopexamples/fhir/omoppersoneverything/OmopPersonEverythingExampleIntegrationTest.java">
								OmopPersonEverythingExampleIntegrationTest
							</a> 
							class gives a simplest complete example of the use of this tool.  
						</p>					
					</td>
				</tr>
				
				<!-- WriteFhirPatientToOmop -->
				<tr>
					<td>
						OMOP:&nbsp;WriteFhirPatientToOmop
					</td>
					<td>
						<p>
							Write a single FHIR patient to an OMOP database instance.  
						</p>
						The WriteFhirPatientToOmop tool uses the OmopPersonEverything class to get the patient information as OMOP DVOs and then inserts these DVOs into the database.  
						The primary use case for this tool takes as parameters simply:
						<ul>
							<li>JSON representation of the FHIR /Patient/[ID]/$everything resource</li>
							<li>A connection to the OMOP database instance</li>
						</ul>
						<p>
							Example: The
							<a target="_blank" href="https://github.com/NACHC-CAD/fhir-to-omop/blob/main/src/test/java/org/nachc/tools/fhirtoomopexamples/fhir/omoppersoneverything/OmopInsertPersonExampleIntegrationTest.java">
								OmopInsertPersonExampleIntegrationTest
							</a> 
							class gives a simplest complete example of the use of this tool.  
						</p>
					</td>
				</tr>
				
				<!-- blank row deliberately included to give bottom line -->
				<tr>
					<td>
					</td>
					<td>
					</td>
				</tr>

			</table>
			
		</div>
	</body>
</html>